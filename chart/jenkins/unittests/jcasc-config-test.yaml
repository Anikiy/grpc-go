suite: Configuration as Code
templates:
  - jcasc-config.yaml
tests:
  - it: default config
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: agent namespace and templates
    release:
      namespace: controller-namespace
    set:
      additionalAgents:
        maven:
          namespace: maven
          podName: maven
          customJenkinsLabels: maven
          image: jenkins/jnlp-agent-maven
          tag: latest
        python:
          podName: python
          customJenkinsLabels: python
          sideContainerName: python
          image: python
          tag: "3"
          command: /bin/sh -c
          args: "cat"
          TTYEnabled: true
      agent:
        namespace: jenkins-agents
        podTemplates:
          python3: |
            - name: python3
              label: jenkins-python3
              serviceAccount: jenkins
              containers:
                - name: python
                  image: python:3
                  command: "/bin/sh -c"
                  args: "cat"
                  ttyEnabled: true
                  privileged: true
                  resourceRequestCpu: "400m"
                  resourceRequestMemory: "512Mi"
                  resourceRequestEphemeralStorage: "1Gi"
                  resourceLimitCpu: "1"
                  resourceLimitMemory: "1024Mi"
                  resourceLimitEphemeralStorage: "2Gi"

    asserts:
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.controller-namespace.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.controller-namespace.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "jenkins-agents"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "jenkins-agents"
                      id: fa33fa17a3a581eb24c93b10cdce8d625ef4ee4e6145269f253d2b7a48ce27b4
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.controller-namespace.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
                    - name: "maven"
                      namespace: "maven"
                      id: 519c05520c082e7b03f4b618fc9e8b5596b85ed6db1fb608a3b7f8985a130b84
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.controller-namespace.svc.cluster.local:8080/"
                        image: "jenkins/jnlp-agent-maven:latest"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent maven"
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
                    - name: "python"
                      namespace: "jenkins-agents"
                      id: 91cce14f8699291c0af8cf24e8761f2421aee625985fce2f874de0cb959c3294
                      containers:
                      - name: "python"
                        alwaysPullImage: false
                        args: "cat"
                        command: /bin/sh -c
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.controller-namespace.svc.cluster.local:8080/"
                        image: "python:3"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: true
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent python"
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
                    - name: python3
                      label: jenkins-python3
                      serviceAccount: jenkins
                      containers:
                        - name: python
                          image: python:3
                          command: "/bin/sh -c"
                          args: "cat"
                          ttyEnabled: true
                          privileged: true
                          resourceRequestCpu: "400m"
                          resourceRequestMemory: "512Mi"
                          resourceRequestEphemeralStorage: "1Gi"
                          resourceLimitCpu: "1"
                          resourceLimitMemory: "1024Mi"
                          resourceLimitEphemeralStorage: "2Gi"

              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: customized config
    set:
      controller:
        disableRememberMe: true
        executorMode: EXCLUSIVE
        numExecutors: 1
        enableRawHtmlMarkupFormatter: true
        JCasC:
          authorizationStrategy: |-
            globalMatrix:
              permissions:
                - "Overall/Read:anonymous"
          configScripts:
            welcome-message: |
              jenkins:
                systemMessage: Welcome to our CI\CD server.  This Jenkins is configured and managed 'as code'.
          securityRealm: local
        jenkinsAdminEmail: admin@example.org
        ingress:
          hostName: jenkins.example.com
          tls:
            - hosts:
                - jenkins.example.com
              secretName: tlsSecret
      agent:
        namespace: default
        containerCap: 22
        jnlpregistry: private.registry.com
        defaultsProviderTemplate: my-defaults
        kubernetesConnectTimeout: 11
        kubernetesReadTimeout: 12
        podName: my-agent
        sideContainerName: sideContainer
        alwaysPullImage: true
        command: /bin/command
        image: my-image/jnlp
        tag: v1.2.3
        privileged: true
        resources:
          limits:
            cpu: 1024m
            memory: 1Gi
            ephemeralStorage: 1Gi
          requests:
            cpu: 756m
            memory: 768Mi
            ephemeralStorage: 512Mi
        runAsUser: 2000
        runAsGroup: 2000
        TTYEnabled: true
        workingDir: /workdir
        envVars:
          - name: VAR
            value: value
        idleMinutes: 30
        imagePullSecretName: pullSecret
        nodeSelector:
          jenkins-agent: v1
          selector: abc
        podRetention: onFailure
        connectTimeout: 111
        volumes:
        - type: ConfigMap
          configMapName: myconfigmap
          mountPath: /var/myapp/myconfigmap
        - type: EmptyDir
          mountPath: /var/myapp/myemptydir
          memory: false
        - type: HostPath
          hostPath: /var/lib/containers
          mountPath: /var/myapp/myhostpath
        - type: Nfs
          mountPath: /var/myapp/mynfs
          readOnly: false
          serverAddress: "192.0.2.0"
          serverPath: /var/lib/containers
        - type: PVC
          claimName: mypvc
          mountPath: /var/myapp/mypvc
          readOnly: false
        - type: Secret
          defaultMode: "600"
          mountPath: /var/myapp/mysecret
          secretName: mysecret
        annotations:
          ci.jenkins-agent/test: "custom"
        yamlTemplate: |-
          apiVersion: v1
          kind: Pod
          spec:
            tolerations:
            - key: "key"
              operator: "Equal"
              value: "value"
        yamlMergeStrategy: merge
      serviceAccountAgent:
        name: agent-serviceaccount
    release:
      name: my-release
      namespace: other
    asserts:
      - hasDocuments:
          count: 2
      - documentIndex: 0
        isKind:
          of: ConfigMap
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - documentIndex: 0
        equal:
          path: metadata.name
          value: my-release-jenkins-jenkins-config-welcome-message
      - documentIndex: 0
        equal:
          path: metadata.namespace
          value: other
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - documentIndex: 1
        isKind:
          of: ConfigMap
      - documentIndex: 1
        equal:
          path: metadata.name
          value: my-release-jenkins-jenkins-jcasc-config
      - documentIndex: 1
        equal:
          path: metadata.namespace
          value: other
      - documentIndex: 0
        equal:
          path: metadata.labels.my-release-jenkins-jenkins-config
          value: "true"
      - documentIndex: 1
        equal:
          path: metadata.labels.my-release-jenkins-jenkins-config
          value: "true"
      - documentIndex: 0
        equal:
          path: data
          value:
            welcome-message.yaml: |-
              jenkins:
                systemMessage: Welcome to our CI\CD server.  This Jenkins is configured and managed 'as code'.
      - documentIndex: 1
        equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                globalMatrix:
                  permissions:
                    - "Overall/Read:anonymous"
              securityRealm:
                local
              disableRememberMe: true
              mode: EXCLUSIVE
              numExecutors: 1
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                rawHtml:
                  disableSyntaxHighlighting: true
              clouds:
              - kubernetes:
                  containerCapStr: "22"
                  jnlpregistry: "private.registry.com"
                  defaultsProviderTemplate: "my-defaults"
                  connectTimeout: "11"
                  readTimeout: "12"
                  jenkinsUrl: "http://my-release-jenkins.other.svc.cluster.local:8080"
                  jenkinsTunnel: "my-release-jenkins-agent.other.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/my-release-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "my-agent"
                      namespace: "default"
                      annotations:
                      - key: ci.jenkins-agent/test
                        value: "custom"
                      id: 6de9914dfb9678a4f580464e046eea7dabd8ade25357bdbe43447cf3be2264ae
                      containers:
                      - name: "sideContainer"
                        alwaysPullImage: true
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command: /bin/command
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://my-release-jenkins.other.svc.cluster.local:8080/"
                        image: "my-image/jnlp:v1.2.3"
                        privileged: "true"
                        resourceLimitCpu: 1024m
                        resourceLimitMemory: 1Gi
                        resourceLimitEphemeralStorage: 1Gi
                        resourceRequestCpu: 756m
                        resourceRequestMemory: 768Mi
                        resourceRequestEphemeralStorage: 512Mi
                        runAsUser: 2000
                        runAsGroup: 2000
                        ttyEnabled: true
                        workingDir: /workdir
                      envVars:
                        - envVar:
                            key: VAR
                            value: value
                      idleMinutes: 30
                      instanceCap: 2147483647
                      imagePullSecrets:
                      - name: pullSecret
                      label: "my-release-jenkins-agent "
                      nodeSelector: jenkins-agent=v1,selector=abc
                      nodeUsageMode: "NORMAL"
                      podRetention: onFailure
                      showRawYaml: true
                      serviceAccount: "agent-serviceaccount"
                      slaveConnectTimeoutStr: "111"
                      volumes:
                        - configMapVolume:
                            configMapName: "myconfigmap"
                            mountPath: "/var/myapp/myconfigmap"
                        - emptyDirVolume:
                            memory: false
                            mountPath: "/var/myapp/myemptydir"
                        - hostPathVolume:
                            hostPath: "/var/lib/containers"
                            mountPath: "/var/myapp/myhostpath"
                        - nfsVolume:
                            mountPath: "/var/myapp/mynfs"
                            readOnly: false
                            serverAddress: "192.0.2.0"
                            serverPath: "/var/lib/containers"
                        - persistentVolumeClaim:
                            claimName: "mypvc"
                            mountPath: "/var/myapp/mypvc"
                            readOnly: false
                        - secretVolume:
                            defaultMode: "600"
                            mountPath: "/var/myapp/mysecret"
                            secretName: "mysecret"
                      yaml: |-
                        apiVersion: v1
                        kind: Pod
                        spec:
                          tolerations:
                          - key: "key"
                            operator: "Equal"
                            value: "value"
                      yamlMergeStrategy: merge
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress: admin@example.org
                url: https://jenkins.example.com
  - it: custom dynamic pvc workspace volume
    set:
      agent:
        workspaceVolume:
          type: "DynamicPVC"
          accessModes: "ReadWriteOnce"
          requestsSize: "2Gi"
          storageClassName: "gp2"
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 067fcef0882b10f163a4e3728b468d1c5c835e8b62f7423cf1fee029c5d802a2
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      workspaceVolume:
                        dynamicPVC:
                          accessModes: "ReadWriteOnce"
                          requestsSize: "2Gi"
                          storageClassName: "gp2"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: custom emptyDir workspace volume
    set:
      agent:
        workspaceVolume:
          type: "EmptyDir"
          memory: true
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 605224081078a8d9c7f68890ed8b37530ca55f79161d1589392db296129b2328
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      workspaceVolume:
                        emptyDirWorkspaceVolume:
                          memory: true
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: custom hostPath workspace volume
    set:
      agent:
        workspaceVolume:
          type: "HostPath"
          hostPath: "/data"
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: ef835bdad4865690a6648a22275700c3d1a04828663f5944534693797e292578
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      workspaceVolume:
                        hostPathWorkspaceVolume:
                          hostPath: "/data"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: custom nfs workspace volume
    set:
      agent:
        workspaceVolume:
          type: "Nfs"
          readOnly: false
          serverAddress: "1.1.1.1"
          serverPath: "/data"
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: a72cba3ce68a3eadd81298f8cd08555145ca92d9aa54df93e07c5dd0fae5a02c
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      workspaceVolume:
                        nfsWorkspaceVolume:
                          readOnly: false
                          serverAddress: "1.1.1.1"
                          serverPath: "/data"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: custom pvc workspace volume
    set:
      agent:
        workspaceVolume:
          type: "PVC"
          claimName: "my-claim"
          readOnly: false
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 0fb89b278fcc7ca2e7fde07d9719c61452b8fb8ffcc5278b322b4426453e368c
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      workspaceVolume:
                        persistentVolumeClaimWorkspaceVolume:
                          claimName: "my-claim"
                          readOnly: false
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: custom other workspace volume
    set:
      agent:
        workspaceVolume:
          type: "persistentVolumeClaimWorkspaceVolume"
          claimName: "my-claim"
          readOnly: false
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: ce6595e446a85f835269e7d76da9b26cb9cdf97f015a0e9ca081a17b1ef0af28
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      workspaceVolume:
                        persistentVolumeClaimWorkspaceVolume:
                          claimName: "my-claim"
                          readOnly: false
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: disable helm.sh label
    set:
      renderHelmLabels: false
    asserts:
      - equal:
          path: metadata.labels
          value:
            RELEASE-NAME-jenkins-jenkins-config: "true"
            app.kubernetes.io/component: jenkins-controller
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/managed-by: Helm
            app.kubernetes.io/name: jenkins
  - it: disable agents
    release:
      namespace: controller-namespace
    set:
      agent.enabled: false
    asserts:
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.controller-namespace.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.controller-namespace.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "controller-namespace"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: disable default config
    set:
      controller.JCasC.defaultConfig: false
    asserts:
      - hasDocuments:
         count: 0
  - it: custom jenkins label
    set:
      controller:
        customJenkinsLabels: ["testlabel"]
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: "testlabel"
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: adds custom labels on agent pods
    set:
      agent:
        podLabels:
          label-one: value-one
          label-two: true
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.NAMESPACE.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.NAMESPACE.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "NAMESPACE"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  - key: "label-one"
                    value: "value-one"
                  - key: "label-two"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "NAMESPACE"
                      id: dcdfe2fcfa63642b10dc0437db653d5995351abd1011b12df9e39b069327ed17
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.NAMESPACE.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: legacyRemotingSecurityEnabled = false
    release:
      namespace: default
    set:
      controller:
        legacyRemotingSecurityEnabled: false
    asserts:
    - isKind:
        of: ConfigMap
    - hasDocuments:
        count: 1
    - isNotEmpty:
        path: data["jcasc-default-config.yaml"]
    - matchRegex:
        path: metadata.labels["helm.sh/chart"]
        pattern: ^jenkins-
    - equal:
        path: data["jcasc-default-config.yaml"]
        value: |-
          jenkins:
            authorizationStrategy:
              loggedInUsersCanDoAnything:
                allowAnonymousRead: false
            securityRealm:
              local:
                allowsSignup: false
                enableCaptcha: false
                users:
                - id: "${chart-admin-username}"
                  name: "Jenkins Admin"
                  password: "${chart-admin-password}"
            disableRememberMe: false
            mode: NORMAL
            numExecutors: 0
            labelString: ""
            projectNamingStrategy: "standard"
            markupFormatter:
              plainText
            clouds:
            - kubernetes:
                containerCapStr: "10"
                defaultsProviderTemplate: ""
                connectTimeout: "5"
                readTimeout: "15"
                jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                maxRequestsPerHostStr: "32"
                retentionTimeout: "5"
                waitForPodSec: "600"
                name: "kubernetes"
                namespace: "default"
                serverUrl: "https://kubernetes.default"
                credentialsId: ""
                podLabels:
                - key: "jenkins/RELEASE-NAME-jenkins-agent"
                  value: "true"
                templates:
                  - name: "default"
                    namespace: "default"
                    id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                    containers:
                    - name: "jnlp"
                      alwaysPullImage: false
                      args: "^${computer.jnlpmac} ^${computer.name}"
                      command:
                      envVars:
                        - envVar:
                            key: "JENKINS_URL"
                            value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                      image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                      privileged: "false"
                      resourceLimitCpu: 512m
                      resourceLimitMemory: 512Mi
                      resourceRequestCpu: 512m
                      resourceRequestMemory: 512Mi
                      runAsUser:
                      runAsGroup:
                      ttyEnabled: false
                      workingDir: /home/jenkins/agent
                    idleMinutes: 0
                    instanceCap: 2147483647
                    label: "RELEASE-NAME-jenkins-agent "
                    nodeUsageMode: "NORMAL"
                    podRetention: Never
                    showRawYaml: true
                    serviceAccount: "default"
                    slaveConnectTimeoutStr: "100"
                    yamlMergeStrategy: override
            crumbIssuer:
              standard:
                excludeClientIPFromCrumb: true
          security:
            apiToken:
              creationOfLegacyTokenEnabled: false
              tokenGenerationOnCreationEnabled: false
              usageStatisticsEnabled: true
          unclassified:
            location:
              adminAddress:
              url: http://RELEASE-NAME-jenkins:8080
  - it: legacyRemotingSecurityEnabled = true
    release:
      namespace: default
    set:
      controller:
        legacyRemotingSecurityEnabled: true
    asserts:
    - isKind:
        of: ConfigMap
    - hasDocuments:
        count: 1
    - isNotEmpty:
        path: data["jcasc-default-config.yaml"]
    - matchRegex:
        path: metadata.labels["helm.sh/chart"]
        pattern: ^jenkins-
    - equal:
        path: data["jcasc-default-config.yaml"]
        value: |-
          jenkins:
            authorizationStrategy:
              loggedInUsersCanDoAnything:
                allowAnonymousRead: false
            securityRealm:
              local:
                allowsSignup: false
                enableCaptcha: false
                users:
                - id: "${chart-admin-username}"
                  name: "Jenkins Admin"
                  password: "${chart-admin-password}"
            disableRememberMe: false
            remotingSecurity:
              enabled: true
            mode: NORMAL
            numExecutors: 0
            labelString: ""
            projectNamingStrategy: "standard"
            markupFormatter:
              plainText
            clouds:
            - kubernetes:
                containerCapStr: "10"
                defaultsProviderTemplate: ""
                connectTimeout: "5"
                readTimeout: "15"
                jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                maxRequestsPerHostStr: "32"
                retentionTimeout: "5"
                waitForPodSec: "600"
                name: "kubernetes"
                namespace: "default"
                serverUrl: "https://kubernetes.default"
                credentialsId: ""
                podLabels:
                - key: "jenkins/RELEASE-NAME-jenkins-agent"
                  value: "true"
                templates:
                  - name: "default"
                    namespace: "default"
                    id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                    containers:
                    - name: "jnlp"
                      alwaysPullImage: false
                      args: "^${computer.jnlpmac} ^${computer.name}"
                      command:
                      envVars:
                        - envVar:
                            key: "JENKINS_URL"
                            value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                      image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                      privileged: "false"
                      resourceLimitCpu: 512m
                      resourceLimitMemory: 512Mi
                      resourceRequestCpu: 512m
                      resourceRequestMemory: 512Mi
                      runAsUser:
                      runAsGroup:
                      ttyEnabled: false
                      workingDir: /home/jenkins/agent
                    idleMinutes: 0
                    instanceCap: 2147483647
                    label: "RELEASE-NAME-jenkins-agent "
                    nodeUsageMode: "NORMAL"
                    podRetention: Never
                    showRawYaml: true
                    serviceAccount: "default"
                    slaveConnectTimeoutStr: "100"
                    yamlMergeStrategy: override
            crumbIssuer:
              standard:
                excludeClientIPFromCrumb: true
          security:
            apiToken:
              creationOfLegacyTokenEnabled: false
              tokenGenerationOnCreationEnabled: false
              usageStatisticsEnabled: true
          unclassified:
            location:
              adminAddress:
              url: http://RELEASE-NAME-jenkins:8080
  - it: empty projectNamingStrategy
    release:
      namespace: default
    set:
      controller:
        projectNamingStrategy:
    asserts:
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: non-string projectNamingStrategy
    release:
      namespace: default
    set:
      controller:
        projectNamingStrategy:
          myConfiguration:
            mySetting1: true
            mySetting2: something
    asserts:
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy:
                myConfiguration:
                  mySetting1: true
                  mySetting2: something
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: specify security settings without apiToken override
    release:
      namespace: default
    set:
      controller:
        JCasC:
          security:
            gitHostKeyVerificationConfiguration:
              sshHostKeyVerificationStrategy: "acceptFirstConnectionStrategy"
    asserts:
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
              gitHostKeyVerificationConfiguration:
                sshHostKeyVerificationStrategy: acceptFirstConnectionStrategy
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: specify security settings without apiToken override
    release:
      namespace: default
    set:
      controller:
        JCasC:
          security:
            apiToken: overridden
    asserts:
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken: overridden
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: specify additional container
    release:
      namespace: default
    set:
      agent:
        additionalContainers:
          - sideContainerName: dind
            image: docker
            tag: dind
            command: dockerd-entrypoint.sh
            args: ""
            privileged: true
    asserts:
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: fbfed069d6bf26a9928c0f79915d3c7305b568f6ef29995524b476f2c98c0e42
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      - name: "dind"
                        alwaysPullImage: false
                        args: ""
                        command: dockerd-entrypoint.sh
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "docker:dind"
                        privileged: "true"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: specify additional container and overwrite in additional agent
    release:
      namespace: default
    set:
      agent:
        additionalContainers:
          - sideContainerName: dind
            image: docker
            tag: dind
            command: dockerd-entrypoint.sh
            args: ""
            privileged: true
      additionalAgents:
        additional-agent:
          podName: additional-agent
          additionalContainers:
            - sideContainerName: additional
              image: my-additional-container-image
              tag: latest
              command: entrypoint.sh
              args: arg1 arg2
    asserts:
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: fbfed069d6bf26a9928c0f79915d3c7305b568f6ef29995524b476f2c98c0e42
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      - name: "dind"
                        alwaysPullImage: false
                        args: ""
                        command: dockerd-entrypoint.sh
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "docker:dind"
                        privileged: "true"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
                    - name: "additional-agent"
                      namespace: "default"
                      id: 4cb1b28f4fa92261fec428bc1245a39a065f21ca69ffe9715dd3f8e3a1fe395c
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      - name: "additional"
                        alwaysPullImage: false
                        args: "arg1 arg2"
                        command: entrypoint.sh
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "my-additional-container-image:latest"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: specify additional container and clear in additional agent
    release:
      namespace: default
    set:
      agent:
        additionalContainers:
          - sideContainerName: dind
            image: docker
            tag: dind
            command: dockerd-entrypoint.sh
            args: ""
            privileged: true
      additionalAgents:
        additional-agent:
          podName: additional-agent
          additionalContainers: []
    asserts:
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: fbfed069d6bf26a9928c0f79915d3c7305b568f6ef29995524b476f2c98c0e42
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      - name: "dind"
                        alwaysPullImage: false
                        args: ""
                        command: dockerd-entrypoint.sh
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "docker:dind"
                        privileged: "true"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
                    - name: "additional-agent"
                      namespace: "default"
                      id: 7622a745faff6a9b15a36bd668a64af0e03904ca67eb2c5409228d8d323cfb36
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: configure hostnetworking to agent
    release:
      namespace: default
    set:
      agent:
        hostNetworking: true
    asserts:
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: f155ec0bd24ae05df7910efcc791774c117fc28a74b2bade56e74ccad456c7b0
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      hostNetwork: true
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: set secretEnvVars
    set:
      agent:
        secretEnvVars:
          - key: UNITTEST_PATH
            secretKey: UNITTEST_K8S_PATH
            secretName: k8s-unittest-secret-name
        envVars:
          - name: UNITTEST_ENV
            value: testvalue
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 1a4088ba5aeb723cfa79c768d148ce06e93056e9b7464b5f15c6ccb92f7ffda7
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      envVars:
                        - envVar:
                            key: UNITTEST_ENV
                            value: testvalue
                        - secretEnvVar:
                            key: UNITTEST_PATH
                            secretName: k8s-unittest-secret-name
                            secretKey: UNITTEST_K8S_PATH
                            optional: false
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: set directConnection
    set:
      agent:
        directConnection: true
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
          count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  directConnection: true
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 539b908fac1ed185549b1a32e1254d10ba97d7d4bad3a0344a8a2a0bfc532850
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_DIRECT_CONNECTION"
                              value: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: agents with liveness probe
    set:
      agent:
        livenessProbe:
          execArgs: "cat /tmp/healthy"
          failureThreshold: 3
          initialDelaySeconds: 0
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
          count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 4631810ef8d23d3b61342d6c6dcf80552f812038c993b528331c23347bc10c39
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        livenessProbe:
                          execArgs: "cat /tmp/healthy"
                          failureThreshold: 3
                          initialDelaySeconds: 0
                          periodSeconds: 10
                          successThreshold: 1
                          timeoutSeconds: 1
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: agents with liveness probe
    set:
      agent:
        additionalContainers:
          - sideContainerName: side-container
            image: IMAGE
            tag: TAG
            args: ""
            command: ""
            livenessProbe:
              execArgs: "cat /tmp/healthy"
              failureThreshold: 3
              initialDelaySeconds: 0
              periodSeconds: 10
              successThreshold: 1
              timeoutSeconds: 1
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
          count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: f75348a7b0abec0b1d5ac55f823e64ebd76898d4ee4a7a9d0df845881d48617d
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      - name: "side-container"
                        alwaysPullImage: false
                        args: ""
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "IMAGE:TAG"
                        livenessProbe:
                          execArgs: "cat /tmp/healthy"
                          failureThreshold: 3
                          initialDelaySeconds: 0
                          periodSeconds: 10
                          successThreshold: 1
                          timeoutSeconds: 1
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: additional clouds
    set:
      additionalClouds:
        remote-cloud-1:
          kubernetesURL: https://api.remote-cloud.com
          credentialsId: "remote-cloud-token"
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "remote-cloud-1"
                  namespace: "default"
                  serverUrl: "https://api.remote-cloud.com"
                  credentialsId: "remote-cloud-token"
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080
  - it: additional clouds inheriting additional agents
    set:
      additionalAgents:
        maven:
          namespace: maven
          podName: maven
          customJenkinsLabels: maven
          image: jenkins/jnlp-agent-maven
          tag: latest
      additionalClouds:
        remote-cloud-1:
          kubernetesURL: https://api.remote-cloud.com
          credentialsId: "remote-cloud-token"
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
                    - name: "maven"
                      namespace: "maven"
                      id: 77265108d78497ecf62874facf837d929a471b1d26e578bdf8cdf15bdea2403a
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/jnlp-agent-maven:latest"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent maven"
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "remote-cloud-1"
                  namespace: "default"
                  serverUrl: "https://api.remote-cloud.com"
                  credentialsId: "remote-cloud-token"
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
                    - name: "maven"
                      namespace: "maven"
                      id: 77265108d78497ecf62874facf837d929a471b1d26e578bdf8cdf15bdea2403a
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/jnlp-agent-maven:latest"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent maven"
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080

  - it: additional clouds overriding additional agents
    set:
      additionalAgents:
        maven:
          namespace: maven
          podName: maven
          customJenkinsLabels: maven
          image: jenkins/jnlp-agent-maven
          tag: latest
      additionalClouds:
        remote-cloud-1:
          kubernetesURL: https://api.remote-cloud.com
          credentialsId: "remote-cloud-token"
          additionalAgentsOverride: true
    release:
      namespace: default
    asserts:
      - isKind:
          of: ConfigMap
      - hasDocuments:
         count: 1
      - isNotEmpty:
          path: data["jcasc-default-config.yaml"]
      - matchRegex:
          path: metadata.labels["helm.sh/chart"]
          pattern: ^jenkins-
      - equal:
          path: data["jcasc-default-config.yaml"]
          value: |-
            jenkins:
              authorizationStrategy:
                loggedInUsersCanDoAnything:
                  allowAnonymousRead: false
              securityRealm:
                local:
                  allowsSignup: false
                  enableCaptcha: false
                  users:
                  - id: "${chart-admin-username}"
                    name: "Jenkins Admin"
                    password: "${chart-admin-password}"
              disableRememberMe: false
              mode: NORMAL
              numExecutors: 0
              labelString: ""
              projectNamingStrategy: "standard"
              markupFormatter:
                plainText
              clouds:
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "kubernetes"
                  namespace: "default"
                  serverUrl: "https://kubernetes.default"
                  credentialsId: ""
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
                    - name: "maven"
                      namespace: "maven"
                      id: 77265108d78497ecf62874facf837d929a471b1d26e578bdf8cdf15bdea2403a
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/jnlp-agent-maven:latest"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent maven"
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              - kubernetes:
                  containerCapStr: "10"
                  defaultsProviderTemplate: ""
                  connectTimeout: "5"
                  readTimeout: "15"
                  jenkinsUrl: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080"
                  jenkinsTunnel: "RELEASE-NAME-jenkins-agent.default.svc.cluster.local:50000"
                  maxRequestsPerHostStr: "32"
                  retentionTimeout: "5"
                  waitForPodSec: "600"
                  name: "remote-cloud-1"
                  namespace: "default"
                  serverUrl: "https://api.remote-cloud.com"
                  credentialsId: "remote-cloud-token"
                  podLabels:
                  - key: "jenkins/RELEASE-NAME-jenkins-agent"
                    value: "true"
                  templates:
                    - name: "default"
                      namespace: "default"
                      id: 923e6d6b3128baaa56764f4b69d4c62b61e55d00f8170e3428f011148767dc99
                      containers:
                      - name: "jnlp"
                        alwaysPullImage: false
                        args: "^${computer.jnlpmac} ^${computer.name}"
                        command:
                        envVars:
                          - envVar:
                              key: "JENKINS_URL"
                              value: "http://RELEASE-NAME-jenkins.default.svc.cluster.local:8080/"
                        image: "jenkins/inbound-agent:3192.v713e3b_039fb_e-5"
                        privileged: "false"
                        resourceLimitCpu: 512m
                        resourceLimitMemory: 512Mi
                        resourceRequestCpu: 512m
                        resourceRequestMemory: 512Mi
                        runAsUser:
                        runAsGroup:
                        ttyEnabled: false
                        workingDir: /home/jenkins/agent
                      idleMinutes: 0
                      instanceCap: 2147483647
                      label: "RELEASE-NAME-jenkins-agent "
                      nodeUsageMode: "NORMAL"
                      podRetention: Never
                      showRawYaml: true
                      serviceAccount: "default"
                      slaveConnectTimeoutStr: "100"
                      yamlMergeStrategy: override
              crumbIssuer:
                standard:
                  excludeClientIPFromCrumb: true
            security:
              apiToken:
                creationOfLegacyTokenEnabled: false
                tokenGenerationOnCreationEnabled: false
                usageStatisticsEnabled: true
            unclassified:
              location:
                adminAddress:
                url: http://RELEASE-NAME-jenkins:8080

